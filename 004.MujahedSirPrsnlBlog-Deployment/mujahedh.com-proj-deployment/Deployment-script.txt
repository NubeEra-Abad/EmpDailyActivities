###For Mujahedh.com

#!/bin/bash

# Git credentials
GIT_USERNAME="nubeera.saad"
GIT_PASSWORD="glpat-KRk76oGGFys1YWppjuN3"

# Create the directory for the project
sudo mkdir -p /var/www/mujahedh

# Clone the Git repository to the created directory
sudo git clone https://gitlab.com/NubeEra/mujahedh.git /var/www/mujahedh

# Install Nginx
sudo apt update
sudo apt install nginx -y

# Create a server block file for the project
sudo nano /etc/nginx/sites-available/mujahedh

# Enable the server block by creating a symbolic link
sudo ln -s /etc/nginx/sites-available/mujahedh /etc/nginx/sites-enabled/

# Configure Nginx to use the server block
sudo sed -i '/http {/a \\tinclude /etc/nginx/sites-enabled/*;' /etc/nginx/nginx.conf

# Set permissions for the project directory
sudo chown -R www-data:www-data /var/www/mujahedh
sudo chmod -R 755 /var/www/mujahedh

# Reload Nginx to apply the changes
sudo systemctl reload nginx
------------------------------------------------------------------------------------


##For nubeera.com

#!/bin/bash

# Update the system
sudo apt-get update
sudo apt-get upgrade -y

# Install Git, Nginx, and PHP
sudo apt-get install git nginx php-fpm -y

# Configure Nginx for PHP
sudo sed -i 's/# server_tokens off;/server_tokens off;/g' /etc/nginx/nginx.conf
sudo systemctl enable nginx
sudo systemctl start nginx

# Create the directory for the project
sudo mkdir -p /var/www/nubeera

# Clone the Git repository for your website
sudo git clone https://gitlab.com/NubeEra/nubeera.com.git /var/www/nubeera

# Set the Git credentials for pushing changes
sudo git config --global user.email "nubeera.saad@gmail.com"
sudo git config --global user.name "nubeera.saad"

# Create a new Nginx virtual host configuration file for your website
sudo cat <<EOF >/etc/nginx/sites-available/nubeera
server {
    listen 80;
    listen [::]:80;
    server_name nubeera.com;

    root /var/www/nubeera;
    index index.php index.html;

    location / {
        try_files \$uri \$uri/ /index.php?\$args;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
    }

    location ~ /\.ht {
        deny all;
    }

    error_log /var/log/nginx/nubeera_error.log;
    access_log /var/log/nginx/nubeera_access.log;
}
EOF

# Enable the new virtual host configuration file
sudo ln -s /etc/nginx/sites-available/nubeera /etc/nginx/sites-enabled/

# Test the Nginx configuration and reload Nginx
sudo nginx -t
sudo systemctl reload nginx

# Set the correct permissions for the web files
sudo chown -R www-data:www-data /var/www/nubeera
sudo chmod 755 /var/www/nubeera -R
sudo chmod 644 /var/www/nubeera/* -R

# Restart PHP-FPM for the changes to take effect
sudo systemctl restart php7.4-fpm

echo "Setup complete!"
